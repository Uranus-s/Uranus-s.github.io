<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta 
    name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta 
    http-equiv="X-UA-Compatible" 
    content="ie=edge">
  <meta 
    name="theme-color" 
    content="#fff" 
    id="theme-color">
  <meta 
    name="description" 
    content="Gas">
  <link 
    rel="icon" 
    href="/img/Kaze.png">
  <title>SpringBoot-SpringSecurity</title>
  
    
      <meta 
        property="og:title" 
        content="SpringBoot-SpringSecurity">
    
    
      <meta 
        property="og:url" 
        content="http://example.com/2021/05/18/SpringBoot-SpringSecurity/index.html">
    
    
      <meta 
        property="og:img" 
        content="/img/Kaze.png">
    
    
    
      <meta 
        property="og:type" 
        content="article">
      <meta 
        property="og:article:published_time" 
        content="2021-05-18">
      <meta 
        property="og:article:modified_time" 
        content="2021-05-24">
      <meta 
        property="og:article:author" 
        content="Gas">
      
        
          <meta 
            property="og:article:tag" 
            content="Spring">
        
          <meta 
            property="og:article:tag" 
            content="SpringBoot">
        
          <meta 
            property="og:article:tag" 
            content="SpringSecurity">
        
      
    
  
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
    function loadCSS(href, data, attr) {
      var sheet = document.createElement('link');
      sheet.ref = 'stylesheet';
      sheet.href = href;
      sheet.dataset[data] = attr;
      document.head.appendChild(sheet);
    }
    function changeCSS(cssFile, data, attr) {
      var oldlink = document.querySelector(data);
      var newlink = document.createElement("link");
      newlink.setAttribute("rel", "stylesheet");
      newlink.setAttribute("href", cssFile);
      newlink.dataset.prism = attr;
      document.head.replaceChild(newlink, oldlink);
    }
  </script>
  
    
      
      
      
      
        
        
        
        <script>
          function prismThemeChange() {
            if(document.getElementById('theme-color').dataset.mode === 'dark') {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism-tomorrow.min.css', '[data-prism]', 'prism-tomorrow');
              } else {
                loadCSS('/js/lib/prism/prism-tomorrow.min.css', 'prism', 'prism-tomorrow');
              }
            } else {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism-okaidia.min.css', '[data-prism]', 'prism-okaidia');
              } else {
                loadCSS('/js/lib/prism/prism-okaidia.min.css', 'prism', 'prism-okaidia');
              }
            }
          }
          prismThemeChange()
        </script>
      
      
        
        <link rel="stylesheet" href="/js/lib/prism/prism-line-numbers.min.css">
      
    
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
  </script>
  
    <script>
      var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
        document.getElementById('theme-color').dataset.mode = getCssMediaQuery();
        prismThemeChange();
      }
    };
    setDarkmode();
    </script>
  
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  
  
  <link rel="stylesheet" href="/css/main.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">
  
    <link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">
  
<meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <div class="wrapper">
       
      <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
        <img 
          class="navbar-logo-img" 
          src="/img/Kaze.png" 
          alt="blog logo">
      
      <span class="navbar-logo-dsc">Gas</span>
    </span>
  </div>
  <div class="navbar-menu">
    
      <a 
        href="/" 
        class="navbar-menu-item">
        
          首页
        
      </a>
    
      <a 
        href="/archives" 
        class="navbar-menu-item">
        
          归档
        
      </a>
    
      <a 
        href="/tags" 
        class="navbar-menu-item">
        
          标签
        
      </a>
    
      <a 
        href="/categories" 
        class="navbar-menu-item">
        
          分类
        
      </a>
    
      <a 
        href="/about" 
        class="navbar-menu-item">
        
          关于
        
      </a>
    
      <a 
        href="/links" 
        class="navbar-menu-item">
        
          友链
        
      </a>
    
    <a 
      class="navbar-menu-item darknavbar" 
      id="dark">
      <i class="iconfont icon-weather"></i>
    </a>
    <a 
      class="navbar-menu-item searchnavbar" 
      id="search">
      <i 
        class="iconfont icon-search" 
        style="font-size: 1.2rem; font-weight: 400;">
      </i>
    </a>
  </div>
</nav> 
      
      <div 
        id="local-search" 
        style="display: none">
        <input
          class="navbar-menu-item"
          id="search-input"
          placeholder="请输入搜索内容..." />
        <div id="search-content"></div>
      </div>
      
      <div class="section-wrap">
        <div class="container">
          <div class="columns">
            <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      SpringBoot-SpringSecurity
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2021-05-18T12:37:00.000Z">
      <i 
        class="iconfont icon-calendar" 
        style="margin-right: 2px;">
      </i>
      <span>2021-05-18</span>
    </time>
    
      <span class="dot"></span>
      
        <a 
          href="/categories/SpringBoot/" 
          class="post-meta-link">
          SpringBoot
        </a>
      
    
    
      <span class="dot"></span>
      <span>4.4k 字</span>
    
  </div>
  
    <div 
      class="post-meta post-show-meta" 
      style="margin-top: -10px;">
      <div style="display: flex; align-items: center;">
        <i 
          class="iconfont icon-biaoqian" 
          style="margin-right: 2px; font-size: 1.15rem;">
        </i>
        
          
          <a 
            href="/tags/Spring/" 
            class="post-meta-link">
            Spring
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/tags/SpringBoot/" 
            class="post-meta-link">
            SpringBoot
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/tags/SpringSecurity/" 
            class="post-meta-link">
            SpringSecurity
          </a>
        
      </div>
    </div>
  
  </header>
  <div 
    id="section" 
    class="post-content">
    <h2 id="SpringSecurity简介"><a href="#SpringSecurity简介" class="headerlink" title="SpringSecurity简介"></a>SpringSecurity简介</h2><p>SpringSecurity是Spring安全框架中的一员，在SpringBoot出现之前，SpringSecurity已经发展了许久了，但使用并不多，这个领域一直都是Shiro的天下。</p>
<p>相对于Shiro，在SSM/SSH中整合SpringSecurity都是比较麻烦的，所以即使SpringSecurity功能比Shiro强大，但使用反而没Shiro多（虽然Shiro功能没用SpringSecurity多，但绝大部分项目而言，已经够用了）。</p>
<p>SpringBoot出来以后，对SpringSecurity提供了自动化配置方案，可以零配置使用SpringSecurity。</p>
<p>所以常见的技术栈组合是如下：</p>
<ul>
<li>SSM + Shiro</li>
<li>SpringBoot + SpringSecurity</li>
</ul>
<p>回到SpringSecurity，它的核心实现就是维护了一组过滤器链。</p>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>创建项目，引入依赖</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!--可选--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
    &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
<p>随意编写Controller</p>
<pre><code class="java">@Controller
public class RouterController &#123;
    @GetMapping(&#123;&quot;/&quot;,&quot;/index&quot;&#125;)
    public String index()&#123;
        return &quot;index&quot;;
    &#125;

    @GetMapping(&quot;/tologin&quot;)
    public String tologin()&#123;
        return &quot;views/login&quot;;
    &#125;

    @GetMapping(&quot;/level1/&#123;id&#125;&quot;)
    public String level1(@PathVariable(&quot;id&quot;) int id)&#123;
        return &quot;views/level1/&quot;+id;
    &#125;

    @GetMapping(&quot;/level2/&#123;id&#125;&quot;)
    public String level2(@PathVariable(&quot;id&quot;) int id)&#123;
        return &quot;views/level2/&quot;+id;
    &#125;

    @GetMapping(&quot;/level3/&#123;id&#125;&quot;)
    public String level3(@PathVariable(&quot;id&quot;) int id)&#123;
        return &quot;views/level3/&quot;+id;
    &#125;
&#125;
</code></pre>
<p><strong>默认情况下，引入了SpringSecurity，所有的页面都需要进行认证</strong></p>
<p>编写配置类，修改默认配置</p>
<pre><code class="java">//@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter  &#123;

    //这里可以配置一些忽略拦截项 当然也可以下面走匿名访问 不建议
    @Override
    public void configure(WebSecurity web) throws Exception &#123;
        //静态资源过滤
        web.ignoring().antMatchers(&quot;/resources/**&quot;);
        //过滤某个路由
        web.ignoring().antMatchers(&quot;/vercode&quot;);
    &#125;

    @Override
    protected void configure(HttpSecurity http) throws Exception &#123;
        http.authorizeRequests()
                //为不同的访问路径配置不同的权限
                .antMatchers(&quot;/level1/**&quot;).hasAnyRole(&quot;vip1&quot;,&quot;vip2&quot;,&quot;vip3&quot;)
                .antMatchers(&quot;/level2/**&quot;).hasAnyRole(&quot;vip2&quot;,&quot;vip3&quot;)
                .antMatchers(&quot;/level3/**&quot;).hasAnyRole(&quot;vip3&quot;)
                //剩下的路径设置为所有人皆可访问
                .anyRequest().permitAll();
        
        //配置登录相关
        http.formLogin()
            //登录页所在路由 默认/login
            .loginPage(&quot;/tologin&quot;)
            //登录表单发送目标的地址 如果不配置 默认是你的登录页所在路由
            .loginProcessingUrl(&quot;/login&quot;)
            //表单中参数的名称 默认username password
            .usernameParameter(&quot;name&quot;)
            .passwordParameter(&quot;pwd&quot;)
            .successHandler(new AuthenticationSuccessHandler() &#123;
                    @Override
                    public void onAuthenticationSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication) throws IOException, ServletException &#123;
                        //判断请求是异步(返回JSON)还是同步(返回页面)
                        String xRequestedWith = request.getHeader(&quot;x-requested-with&quot;);//通过请求头判断
                        if(&quot;XMLHttpRequest&quot;.equals(xRequestedWith))&#123;//异步返回
                            response.setContentType(&quot;application/plain;charset=utf-8&quot;);
                            PrintWriter writer = response.getWriter();
                            writer.write(CommunityUtil.getJSONString(403,&quot;你还没有登录&quot;));
                        &#125;else &#123;//同步返回
                            response.sendRedirect(request.getContextPath()+&quot;/login&quot;);
                        &#125;
                    &#125;
                &#125;)
            .failureHandler(new AuthenticationFailureHandler() &#123;
                    @Override
                    public void onAuthenticationFailure(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e) throws IOException, ServletException &#123;
                        //同上
                    &#125;
                &#125;)
        
        //退出登录相关配置 差不多和上面一样 源码中有简易的教学Demo
        http.logout();
        
        //记住我功能，如果你使用的是自定义登录页面，需要自己写选择框
        http.rememberMe()
            //表单中参数的名称
            .rememberMeParameter(&quot;remember&quot;);
    &#125;

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;
        //添加账户，向内存中，一般用来测试用的，实际开发一般不这么玩
        //BCryptPasswordEncoder是SpringSecurity提供的密码编码工具，可以非常方便的时间密码的加密和加盐，相同明文加密的密码完全不同
        auth.inMemoryAuthentication().passwordEncoder(new BCryptPasswordEncoder())
                .withUser(&quot;saber&quot;).password(new BCryptPasswordEncoder().encode(&quot;123&quot;)).roles(&quot;vip1&quot;)
                .and()
                .withUser(&quot;root&quot;).password(new BCryptPasswordEncoder().encode(&quot;123&quot;)).roles(&quot;vip1&quot;,&quot;vip2&quot;,&quot;vip3&quot;);
    &#125;
    //也可以通过配置文件配置
    //spring.security.user.name=javaboy
    //spring.security.user.password=123
&#125;
</code></pre>
<p>到此为止，一个大体的使用框架就搭建完成了，可以进行测试了</p>
<h2 id="更多使用"><a href="#更多使用" class="headerlink" title="更多使用"></a>更多使用</h2><h3 id="登录成功和失败处理"><a href="#登录成功和失败处理" class="headerlink" title="登录成功和失败处理"></a>登录成功和失败处理</h3><pre><code class="java">        http.formLogin()
                .loginPage(&quot;/tologin&quot;)
                .loginProcessingUrl(&quot;/login&quot;)
                .usernameParameter(&quot;name&quot;)
                .passwordParameter(&quot;pwd&quot;)
                //登录成功于失败的跳转路由
                .successForwardUrl(&quot;/success&quot;)
                .failureForwardUrl(&quot;/failure&quot;);
</code></pre>
<p>一般上面这种做法无法满足我们的需求，而且查看源码可知，底层就是一个forward跳转，我们知道forward跳转是无法跳到应用之外的页面的，由于这些功能往往会有比较复杂的逻辑，所以SpringSecurity给我们提供了<code>.successHandler()</code>方法去自己实现一个成功跳转逻辑，需要给他一个实现了<code>AuthenticationSuccessHandler</code>接口的类，它会去执行里面的<code>onAuthenticationSuccess()</code>方法</p>
<pre><code class="java">        http.formLogin()
                .loginPage(&quot;/tologin&quot;)
                .loginProcessingUrl(&quot;/login&quot;)
                .usernameParameter(&quot;name&quot;)
                .passwordParameter(&quot;pwd&quot;)
                //也可以使用简单的路径跳转，看需求 .successForwardUrl()
                .successHandler(new AuthenticationSuccessHandler() &#123;
                    //这里直接在这里实例化一个接口，也可以先创建一个类继承接口在实现，然后通过new的形式或注入的形式在这里使用
                    @Override
                    public void onAuthenticationSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication) throws IOException, ServletException &#123;
                        //判断请求是异步(返回JSON)还是同步(返回页面)
                        String xRequestedWith = httpServletRequest.getHeader(&quot;x-requested-with&quot;);//通过请求头判断
                        if(&quot;XMLHttpRequest&quot;.equals(xRequestedWith))&#123;//异步返回
                            httpServletResponse.setContentType(&quot;application/plain;charset=utf-8&quot;);
                            PrintWriter writer = httpServletResponse.getWriter();
                            writer.write(CommunityUtil.getJSONString(403,&quot;你还没有登录&quot;));
                        &#125;else &#123;//同步返回
                            httpServletResponse.sendRedirect(httpServletRequest.getContextPath()+&quot;/login&quot;);
                        &#125;
                    &#125;
                &#125;)
                .failureHandler(new AuthenticationFailureHandler() &#123;
                    @Override
                    public void onAuthenticationFailure(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e) throws IOException, ServletException &#123;
                        
                    &#125;
                &#125;);
</code></pre>
<p>上面采用了最简单的写法，可读性差，建议还是自己去继承并实现，然后通过new的方式或注入的方式提供给<code>.successHandler()</code></p>
<h3 id="权限不足处理"><a href="#权限不足处理" class="headerlink" title="权限不足处理"></a>权限不足处理</h3><pre><code class="java">         //权限不够时
        http.exceptionHandling()
                .authenticationEntryPoint(new AuthenticationEntryPoint() &#123;
                    //没有登录时处理
                    @Override
                    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException e) throws IOException, ServletException &#123;
                        //判断请求是异步(返回JSON)还是同步(返回页面)
                        String xRequestedWith = request.getHeader(&quot;x-requested-with&quot;);//通过请求头判断
                        if(&quot;XMLHttpRequest&quot;.equals(xRequestedWith))&#123;//异步返回
                            response.setContentType(&quot;application/plain;charset=utf-8&quot;);
                            PrintWriter writer = response.getWriter();
                            writer.write(CommunityUtil.getJSONString(403,&quot;你还没有登录&quot;));
                        &#125;else &#123;//同步返回
                            response.sendRedirect(request.getContextPath()+&quot;/login&quot;);
                        &#125;
                    &#125;
                &#125;)
                .accessDeniedHandler(new AccessDeniedHandler() &#123;
                    //权限不足时处理
                    @Override
                    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException e) throws IOException, ServletException &#123;
                        //判断请求是异步(返回JSON)还是同步(返回页面)
                        String xRequestedWith = request.getHeader(&quot;x-requested-with&quot;);//通过请求头判断
                        if(&quot;XMLHttpRequest&quot;.equals(xRequestedWith))&#123;//异步返回
                            response.setContentType(&quot;application/plain;charset=utf-8&quot;);
                            PrintWriter writer = response.getWriter();
                            writer.write(CommunityUtil.getJSONString(403,&quot;权限不足&quot;));
                        &#125;else &#123;//同步返回
                            response.sendRedirect(request.getContextPath()+&quot;/denied&quot;);
                        &#125;
                    &#125;
                &#125;);
</code></pre>
<h3 id="自定义登录逻辑"><a href="#自定义登录逻辑" class="headerlink" title="自定义登录逻辑"></a>自定义登录逻辑</h3><p>自定义登录逻辑需要创建一个实现<code>UserDetailsService</code>接口的类，并把它注入到IOC容器中</p>
<pre><code class="java">@Service
public class UserDetailsServiceImpl implements UserDetailsService &#123;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Autowired
    private UserMapper userMapper;

    @Autowired
    private RoleMapper roleMapper;

    @Bean
    private BCryptPasswordEncoder passwordEncoder() &#123;
        return new BCryptPasswordEncoder();
    &#125;

    @Override
    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException &#123;

        com.example.security.entity.User u = userMapper.findUserByName(s);
        System.out.println(u.toString());
        if (u == null) &#123;
            throw new UsernameNotFoundException(&quot;用户名不存在！&quot;);
        &#125;
        //比较密码，匹配成功会返回UserDetails，实际上也会去数据库查
        String password = passwordEncoder.encode(u.getPassword());

        //用于添加用户的权限。只要把用户权限添加到authorities。
        List&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();
        Role role = roleMapper.findRoleById((int) u.getRoleId());
        if (role != null) &#123;
            //使用Role和Authority都是这一套代码
            //这里有给大坑 如果你使用Role进行授权的话，一定要如下加上 ROLE_
            authorities.add(new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.getRoleName()));
        &#125;

        User user = new User(u.getUsername(), password, authorities);
        return user;
    &#125;
&#125;
</code></pre>
<p>然后在配置类中添加如下(不是必须的，建议写上):</p>
<pre><code class="java">@Autowired
UserDetailsService userDetailsService;

@Override
protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;
    auth.userDetailsService(userDetailsService);
&#125;
</code></pre>
<h3 id="认证授权注解"><a href="#认证授权注解" class="headerlink" title="认证授权注解"></a>认证授权注解</h3><p>在使用注解前需要在配置类或启动类上添加<code>@EnableGlobalMethodSecurity</code>表示开启注解认证授权</p>
<h4 id="Secured"><a href="#Secured" class="headerlink" title="@Secured"></a>@Secured</h4><p>需要在上面添加的注解中添加一个参数<code>@EnableGlobalMethodSecurity(securedEnabled = true)</code>,开启这个注解的使用</p>
<p>用户具有某个Role可以访问，在Controller中使用</p>
<pre><code class="java">@GetMapping(&quot;/level1&quot;)
@Secured(&#123;&quot;ROLE_vip1&quot;,&quot;ROLE_vip2&quot;,&quot;ROLE_vip3&quot;&#125;)
public String level1() &#123;
    return &quot;level1&quot;;
&#125;

@GetMapping(&quot;/level2&quot;)
@Secured(&#123;&quot;ROLE_vip2&quot;,&quot;ROLE_vip3&quot;&#125;)
public String level2() &#123;
    return &quot;level2&quot;;
&#125;

@GetMapping(&quot;/level3&quot;)
@Secured(&#123;&quot;ROLE_vip3&quot;&#125;)
public String level3() &#123;
    return &quot;level3&quot;;
&#125;
</code></pre>
<h4 id="PreAuthorize"><a href="#PreAuthorize" class="headerlink" title="@PreAuthorize"></a>@PreAuthorize</h4><p>需要在上面添加的注解中添加一个参数<code>@EnableGlobalMethodSecurity(prePostEnabled = true)</code>,开启这个注解的使用</p>
<p>进入方法执行之前进行验证</p>
<pre><code class="java">@GetMapping(&quot;/level3&quot;)
//@PreAuthorize(&quot;hasRole(&#39;ROLE_xxx&#39;)&quot;) 这里直接使用上面介绍过的方法名称 就根调用方法一样
    @PreAuthorize(&quot;hasAnyAuthority(&#39;admin3&#39;)&quot;)
public String level3() &#123;
    return &quot;level3&quot;;
&#125;
</code></pre>
<h4 id="PostAuthorize"><a href="#PostAuthorize" class="headerlink" title="@PostAuthorize"></a>@PostAuthorize</h4><p>需要在上面添加的注解中添加一个参数<code>@EnableGlobalMethodSecurity(prePostEnabled = true)</code>,开启这个注解的使用</p>
<p>在方法执行之后判断是否有权限</p>
<pre><code class="java">@GetMapping(&quot;/level3&quot;)
@PostAuthorize(&quot;hasAnyAuthority(&#39;admin3&#39;)&quot;)
public String level3() &#123;
    System.out.println(&quot;fwcg&quot;);
    return &quot;level3&quot;;
&#125;
</code></pre>
<h4 id="PreFilter-PostFilter"><a href="#PreFilter-PostFilter" class="headerlink" title="@PreFilter / @PostFilter"></a>@PreFilter / @PostFilter</h4><p>对传入 / 传出的数据进行过滤 Spring Security将移除使对应表达式的结果为false的元素。</p>
<pre><code class="java">@PostFilter(&quot;filterObject.id%2==0&quot;)
@GetMapping(&quot;/getuser&quot;)
public List&lt;User&gt; findAll() &#123;
    List&lt;User&gt; userList = new ArrayList&lt;User&gt;();
    User user;
    for (int i = 0; i &lt; 10; i++)&#123;
        user = new User();
        user.setId(i);
        userList.add(user);
    &#125;
    System.out.println(userList);
    return userList;
&#125;
</code></pre>
<p>上述代码表示将对返回结果中id不为偶数的user进行移除。filterObject是使用@PreFilter和@PostFilter时的一个内置表达式，表示集合中的当前对象</p>
<p>当@PreFilter标注的方法拥有多个集合类型的参数时，需要通过@PreFilter的filterTarget属性指定当前@PreFilter是针对哪个参数进行过滤的。</p>
<pre><code class="java">@PreFilter(filterTarget=&quot;ids&quot;, value=&quot;filterObject%2==0&quot;)
public void delete(List&lt;Integer&gt; ids, List&lt;String&gt; usernames) &#123;
    ...
&#125;
</code></pre>
<h3 id="记住我"><a href="#记住我" class="headerlink" title="记住我"></a>记住我</h3><p>最简单的实现方式是<strong>储存在内存中</strong>，在配置类中添加如下代码即可</p>
<pre><code class="java">http.rememberMe();//实现记住我自动登录，核心的代码只有这这一行
</code></pre>
<p>如果你使用默认登录页，什么也不用做，但如果你是自定义的，请在页面中添加复选框，</p>
<pre><code class="html">&lt;label&gt; &lt;input type=&quot;checkbox&quot; name=&quot;remember-me&quot; /&gt;记住我&lt;/label&gt;
</code></pre>
<p>前端传值时SpringSecurity将读取键： remember-me，只能叫这个名，Ajax传递参数也必须为 remember-me，但后端可以通过<code>.rememberMeParameter(&quot;xxx&quot;) </code>修改参数名称，还可以通过<code>.rememberMeCookieName()</code>修改Cookie中Key的名称</p>
<p><code>.tokenValiditySeconds(60*2)</code>这个可以修改有效时长默认2周，单位秒</p>
<pre><code class="java">http.rememberMe()
    .rememberMeParameter(&quot;rm&quot;)
    .rememberMeCookieName(&quot;rm-cookie&quot;)
    .tokenValiditySeconds(60*2);
</code></pre>
<p><strong>基于数据库的实现</strong></p>
<p>全部操作在配置类中</p>
<p>先注入数据源</p>
<pre><code class="java">@Autowired
private DataSource dataSource;
</code></pre>
<p>注入TokenRepostory组件</p>
<pre><code class="java">@Bean
public PersistentTokenRepository persistentTokenRepository() &#123;
    JdbcTokenRepositoryImpl jdbcTokenRepository = new JdbcTokenRepositoryImpl();
    jdbcTokenRepository.setDataSource(dataSource);//使用数据源
    jdbcTokenRepository.setCreateTableOnStartup(true);//创建数据表，第一次运行的时候使用，以后注释吊，不然报错
    return jdbcTokenRepository;
&#125;
</code></pre>
<p>配置</p>
<pre><code class="java">http.rememberMe()
    .rememberMeParameter(&quot;rm&quot;)
    .rememberMeCookieName(&quot;rm-cookie&quot;)
    .tokenRepository(persistentTokenRepository())
    .tokenValiditySeconds(60*2);
    //.userDetailsService(userDetailsService);//如果上面自定义登录中直接指示了auth.userDetailsService(userDetailsService);这里可以不写
</code></pre>
<p>这样即可</p>
<h2 id="整合JWT"><a href="#整合JWT" class="headerlink" title="整合JWT"></a>整合JWT</h2><h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
    &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
    &lt;version&gt;0.9.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="创建JWT工具类"><a href="#创建JWT工具类" class="headerlink" title="创建JWT工具类"></a>创建JWT工具类</h3><p>管理Token相关的操作</p>
<pre><code class="java">/**
 * jwt 工具类 主要是生成token 检查token等相关方法
 */
public class JwtUtils &#123;

    public static final String TOKEN_HEADER = &quot;Authorization&quot;;

    public static final String TOKEN_PREFIX = &quot;Bearer &quot;;

    // TOKEN 过期时间
    public static final long EXPIRATION = 1000 * 60 * 30; // 三十分钟

    public static final String APP_SECRET_KEY = &quot;secret&quot;;

    private static final String ROLE_CLAIMS = &quot;rol&quot;;

    /**
     * 生成token
     *
     * @param username
     * @param roles
     * @return
     */
    public static String createToken(String username, List&lt;String&gt; roles) &#123;

        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(ROLE_CLAIMS, roles);

        String token = Jwts
                .builder()
                .setSubject(username)
                .setClaims(map)
                .claim(&quot;username&quot;, username)
                .setIssuedAt(new Date())
                .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION))
                .signWith(SignatureAlgorithm.HS256, APP_SECRET_KEY).compact();
        return token;
    &#125;

    /**
     * 获取当前登录用户用户名
     *
     * @param token
     * @return
     */
    public static String getUsername(String token) &#123;
        Claims claims = Jwts.parser().setSigningKey(APP_SECRET_KEY).parseClaimsJws(token).getBody();
        return claims.get(&quot;username&quot;).toString();
    &#125;

    /**
     * 获取当前登录用户角色
     *
     * @param token
     * @return
     */
    public static ArrayList&lt;String&gt; getUserRole(String token) &#123;
        Claims claims = Jwts.parser().setSigningKey(APP_SECRET_KEY).parseClaimsJws(token).getBody();
        ArrayList&lt;String&gt; rols = claims.get(&quot;rol&quot;, ArrayList.class);
        return rols;
    &#125;

    /**
     * 获解析token中的信息
     *
     * @param token
     * @return
     */
    public static Claims checkJWT(String token) &#123;
        try &#123;
            final Claims claims = Jwts.parser().setSigningKey(APP_SECRET_KEY).parseClaimsJws(token).getBody();
            return claims;
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
            return null;
        &#125;
    &#125;

    /**
     * 检查token是否过期
     *
     * @param token
     * @return
     */
    public static boolean isExpiration(String token) &#123;
        Claims claims = Jwts.parser().setSigningKey(APP_SECRET_KEY).parseClaimsJws(token).getBody();
        return claims.getExpiration().before(new Date());
    &#125;
&#125;
</code></pre>
<h3 id="创建JwtUser类"><a href="#创建JwtUser类" class="headerlink" title="创建JwtUser类"></a>创建JwtUser类</h3><p>主要用于封装登录用户相关信息，例如用户名，密码，权限集合等，必须实现UserDetails接口</p>
<pre><code class="java">import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import java.util.Collection;
import java.util.Collections;

public class JwtUser implements UserDetails &#123;

    private Integer id;
    private String username;
    private String password;
    private Collection&lt;? extends GrantedAuthority&gt; authorities;

    public JwtUser() &#123;
    &#125;

    // 写一个能直接使用user创建jwtUser的构造器
    public JwtUser(User user, Collection&lt;? extends GrantedAuthority&gt; authorities) &#123;
        id = Math.toIntExact(user.getId());
        username = user.getUsername();
        password = user.getPassword();
        this.authorities = authorities;
    &#125;

    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;
        return authorities;
    &#125;

    public String getPassword() &#123;
        return password;
    &#125;

    public String getUsername() &#123;
        return username;
    &#125;

    public boolean isAccountNonExpired() &#123;
        return true;
    &#125;

    public boolean isAccountNonLocked() &#123;
        return true;
    &#125;

    public boolean isCredentialsNonExpired() &#123;
        return true;
    &#125;

    public boolean isEnabled() &#123;
        return true;
    &#125;
&#125;
</code></pre>
<h3 id="创建JwtUserService"><a href="#创建JwtUserService" class="headerlink" title="创建JwtUserService"></a>创建JwtUserService</h3><p>类似于自定义登录逻辑，必须实现UserDetailsService</p>
<pre><code class="java">@Service
public class JwtUserService implements UserDetailsService &#123;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Autowired
    private UserMapper userMapper;

    @Autowired
    private RoleMapper roleMapper;

    @Bean
    private BCryptPasswordEncoder passwordEncoder() &#123;
        return new BCryptPasswordEncoder();
    &#125;

    /**
     * 根据前端传入的用户信息 去数据库查询是否存在该用户
     *
     * @param s
     * @return
     * @throws UsernameNotFoundException
     */
    @Override
    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException &#123;
        User user = this.userMapper.findUserByName(s);

        user.setPassword(passwordEncoder.encode(user.getPassword()));

        //用于添加用户的权限。只要把用户权限添加到authorities。
        List&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();
        Role role = roleMapper.findRoleById((int) user.getRoleId());
        if (role != null) &#123;
            authorities.add(new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.getRoleName()));
        &#125;

        if (user != null) &#123;
            JwtUser jwtUser = new JwtUser(user, authorities);
            return jwtUser;
        &#125; else &#123;
            try &#123;
                throw new ValidationException(&quot;该用户不存在&quot;);
            &#125; catch (ValidationException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
        return null;
    &#125;
&#125;
</code></pre>
<h3 id="自定义用户登录拦截器"><a href="#自定义用户登录拦截器" class="headerlink" title="自定义用户登录拦截器"></a>自定义用户登录拦截器</h3><pre><code class="java">/**
 * 验证用户名密码正确后，生成一个token，并将token返回给客户端
 * 该类继承自UsernamePasswordAuthenticationFilter，重写了其中的2个方法 ,
 * attemptAuthentication：接收并解析用户凭证。
 * successfulAuthentication：用户成功登录后，这个方法会被调用，我们在这个方法里生成token并返回。
 */
public class JWTAuthenticationFilter extends UsernamePasswordAuthenticationFilter &#123;

    private AuthenticationManager authenticationManager;

    /**
     * security拦截默认是以POST形式走/login请求，我们这边设置为走/token请求
     *
     * @param authenticationManager
     */
    public JWTAuthenticationFilter(AuthenticationManager authenticationManager) &#123;
        this.authenticationManager = authenticationManager;
        super.setFilterProcessesUrl(&quot;/token&quot;);
    &#125;

    /**
     * 接收并解析用户凭证
     *
     * @param request
     * @param response
     * @return
     * @throws AuthenticationException
     */
    @Override
    public Authentication attemptAuthentication(HttpServletRequest request,
                                                HttpServletResponse response) throws AuthenticationException &#123;
        // 从输入流中获取到登录的信息
        try &#123;
            User loginUser = new ObjectMapper().readValue(request.getInputStream(), User.class);
            return authenticationManager.authenticate(
                    new UsernamePasswordAuthenticationToken(loginUser.getUsername(), loginUser.getPassword())
            );
        &#125; catch (IOException e) &#123;
            e.printStackTrace();
            return null;
        &#125;
    &#125;

    // 成功验证后调用的方法
    // 如果验证成功，就生成token并返回
    @Override
    protected void successfulAuthentication(HttpServletRequest request,
                                            HttpServletResponse response,
                                            FilterChain chain,
                                            Authentication authResult) throws IOException, ServletException &#123;

        JwtUser jwtUser = (JwtUser) authResult.getPrincipal();
        System.out.println(&quot;jwtUser:&quot; + jwtUser.toString());

        List&lt;String&gt; roles = new ArrayList&lt;&gt;();
        Collection&lt;? extends GrantedAuthority&gt; authorities = jwtUser.getAuthorities();
        for (GrantedAuthority authority : authorities) &#123;
            roles.add(authority.getAuthority());
        &#125;

        String token = JwtUtils.createToken(jwtUser.getUsername(), roles);
        // 返回创建成功的token  但是这里创建的token只是单纯的token
        // 按照jwt的规定，最后请求的时候应该是 `Bearer token`
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        response.setContentType(&quot;application/json; charset=utf-8&quot;);
        String tokenStr = JwtUtils.TOKEN_PREFIX + token;
        response.setHeader(&quot;token&quot;, tokenStr);
    &#125;

    // 失败 返回错误就行
    @Override
    protected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed) throws IOException, ServletException &#123;
        response.getWriter().write(&quot;authentication failed, reason: &quot; + failed.getMessage());
    &#125;
&#125;
</code></pre>
<h3 id="自定义权限拦截器"><a href="#自定义权限拦截器" class="headerlink" title="自定义权限拦截器"></a>自定义权限拦截器</h3><p>假如admin登录成功后，携带token去请求其他接口时，该拦截器会判断权限是否正确</p>
<pre><code class="java">/**
 * 登录成功之后走此类进行  鉴定 权限
 */
public class JWTAuthorizationFilter extends BasicAuthenticationFilter &#123;


    public JWTAuthorizationFilter(AuthenticationManager authenticationManager) &#123;
        super(authenticationManager);
    &#125;

    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                    HttpServletResponse response,
                                    FilterChain chain) throws IOException, ServletException &#123;

        String tokenHeader = request.getHeader(JwtUtils.TOKEN_HEADER);
        // 如果请求头中没有Authorization信息则直接放行了
        if (tokenHeader == null || !tokenHeader.startsWith(JwtUtils.TOKEN_PREFIX)) &#123;
            chain.doFilter(request, response);
            return;
        &#125;
        // 如果请求头中有token，则进行解析，并且设置认证信息
        try &#123;
            SecurityContextHolder.getContext().setAuthentication(getAuthentication(tokenHeader));
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
        &#125;
        super.doFilterInternal(request, response, chain);
    &#125;

    // 这里从token中获取用户信息并新建一个token 就是上面说的设置认证信息
    private UsernamePasswordAuthenticationToken getAuthentication(String tokenHeader) throws Exception &#123;

        String token = tokenHeader.replace(JwtUtils.TOKEN_PREFIX, &quot;&quot;);

        // 检测token是否过期 如果过期会自动抛出错误
        JwtUtils.isExpiration(token);
        String username = JwtUtils.getUsername(token);
        ArrayList&lt;String&gt; roles = JwtUtils.getUserRole(token);
        List&lt;SimpleGrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();
        if (roles != null) &#123;
            for (String role : roles) &#123;
                authorities.add(new SimpleGrantedAuthority(role));
            &#125;
        &#125;
        if (username != null) &#123;
            return new UsernamePasswordAuthenticationToken(username, null, authorities);
        &#125;
        return null;
    &#125;
&#125;
</code></pre>
<h3 id="SpringSecurity配置"><a href="#SpringSecurity配置" class="headerlink" title="SpringSecurity配置"></a>SpringSecurity配置</h3><pre><code class="java">@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter &#123;
    @Autowired
    JwtUserService jwtUserService;

    @Autowired
    private DataSource dataSource;

    @Bean
    public PersistentTokenRepository persistentTokenRepository() &#123;
        JdbcTokenRepositoryImpl jdbcTokenRepository = new JdbcTokenRepositoryImpl();
        jdbcTokenRepository.setDataSource(dataSource);
//        jdbcTokenRepository.setCreateTableOnStartup(true);
        return jdbcTokenRepository;
    &#125;


    @Override
    public void configure(WebSecurity web) throws Exception &#123;
        web.ignoring().antMatchers(&quot;/resources/**&quot;);
    &#125;

    @Override
    protected void configure(HttpSecurity http) throws Exception &#123;
        http.authorizeRequests()
                .antMatchers(&quot;/level1/**&quot;).authenticated()//.hasAnyRole(&quot;vip1&quot;,&quot;vip2&quot;,&quot;vip3&quot;)
                .antMatchers(&quot;/level2/**&quot;).authenticated()//.hasAnyRole(&quot;vip2&quot;,&quot;vip3&quot;)
                .antMatchers(&quot;/level3/**&quot;).authenticated()//.hasAnyRole(&quot;vip3&quot;)
                .anyRequest().permitAll();

        http.addFilter(new JWTAuthenticationFilter(authenticationManager())) // 用户登录拦截
            .addFilter(new JWTAuthorizationFilter(authenticationManager())) // 权限拦截
            // 不需要session
            .sessionManagement()
            .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            .and()
            .exceptionHandling();

        http.formLogin();

        http.csrf().disable();

        http.logout().logoutUrl(&quot;/logout&quot;).logoutSuccessUrl(&quot;/getuser&quot;);

        http.rememberMe()
                .rememberMeParameter(&quot;rm&quot;)
                .rememberMeCookieName(&quot;rm-cookie&quot;)
                .tokenRepository(persistentTokenRepository())
                .tokenValiditySeconds(60*2);
    &#125;

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;
        auth.userDetailsService(jwtUserService);
    &#125;
&#125;
</code></pre>
<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><p>官网：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.9.RELEASE/reference/html5/#servlet-applications">https://docs.spring.io/spring-security/site/docs/5.3.9.RELEASE/reference/html5/#servlet-applications</a></p>
<p>视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV15a411A7kP">https://www.bilibili.com/video/BV15a411A7kP</a></p>
<p>参考文章1：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lenve/p/11242055.html">https://www.cnblogs.com/lenve/p/11242055.html</a></p>
<p>参考文章2：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7817e372c1db">https://www.jianshu.com/p/7817e372c1db</a></p>
<p>参考文章3：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42640067/article/details/113062222">https://blog.csdn.net/qq_42640067/article/details/113062222</a></p>
<p>参考文章4：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_22172133/article/details/86503223">https://blog.csdn.net/qq_22172133/article/details/86503223</a></p>
<p>JWT参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45452416/article/details/109528425">https://blog.csdn.net/weixin_45452416/article/details/109528425</a></p>

  </div>
  <div>
    
      <div 
        class="post-note note-warning copyright" 
        style="margin-top: 42px">
        <p>
          <span style="font-weight: bold;">作者：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="/about">
            Gas
          </a>
        </p>
        <p>
          <span style="font-weight: bold;">文章链接：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="http://example.com/2021/05/18/SpringBoot-SpringSecurity/">
            http://example.com/2021/05/18/SpringBoot-SpringSecurity/
          </a>
        </p>
        <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
      </div>
    
  </div>
</article>
<div class="nav">
  
    <div class="nav-item-prev">
      <a 
        href="/2021/05/21/SpringBoot-Shiro/" 
        class="nav-link">
        <i class="iconfont icon-left nav-prev-icon"></i>
        <div>
          <div class="nav-label">上一篇</div>
          
            <div class="nav-title">SpringBoot-Shiro </div>
          
        </div>
      </a>
    </div>
  
  
    <div class="nav-item-next">
      <a 
        href="/2021/05/07/SpringBoot-Elasticsearch/" 
        class="nav-link">
        <div>
          <div class="nav-label">下一篇</div>
          
            <div class="nav-title">SpringBoot-Elasticsearch </div>
          
        </div>
        <i class="iconfont icon-right nav-next-icon"></i>
      </a>
    </div>
  
</div>

<div 
  class="card card-content toc-card" 
  id="mobiletoc">
  <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringSecurity%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">SpringSecurity简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">更多使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E5%92%8C%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">登录成功和失败处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E4%B8%8D%E8%B6%B3%E5%A4%84%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">权限不足处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91"><span class="toc-number">3.3.</span> <span class="toc-text">自定义登录逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">3.4.</span> <span class="toc-text">认证授权注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Secured"><span class="toc-number">3.4.1.</span> <span class="toc-text">@Secured</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PreAuthorize"><span class="toc-number">3.4.2.</span> <span class="toc-text">@PreAuthorize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PostAuthorize"><span class="toc-number">3.4.3.</span> <span class="toc-text">@PostAuthorize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PreFilter-PostFilter"><span class="toc-number">3.4.4.</span> <span class="toc-text">@PreFilter &#x2F; @PostFilter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E4%BD%8F%E6%88%91"><span class="toc-number">3.5.</span> <span class="toc-text">记住我</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88JWT"><span class="toc-number">4.</span> <span class="toc-text">整合JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">4.1.</span> <span class="toc-text">导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJWT%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">创建JWT工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJwtUser%E7%B1%BB"><span class="toc-number">4.3.</span> <span class="toc-text">创建JwtUser类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJwtUserService"><span class="toc-number">4.4.</span> <span class="toc-text">创建JwtUserService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.5.</span> <span class="toc-text">自定义用户登录拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.6.</span> <span class="toc-text">自定义权限拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringSecurity%E9%85%8D%E7%BD%AE"><span class="toc-number">4.7.</span> <span class="toc-text">SpringSecurity配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">参考：</span></a></li></ol>
</div></main>
            <aside class="left-column">
              
              <div class="card card-author">
                
  <img 
    src="/img/Kaze.png" 
    class="author-img" 
    alt="author avatar">

<p class="author-name">Gas</p>
<p class="author-description">咸鱼罢了</p>
<div class="author-message">
  <a 
    class="author-posts-count" 
    href="/archives">
    <span>30</span>
    <span>文章</span>
  </a>
  <a 
    class="author-categories-count" 
    href="/categories">
    <span>10</span>
    <span>分类</span>
  </a>
  <a 
    class="author-tags-count" 
    href="/tags">
    <span>30</span>
    <span>标签</span>
  </a>
</div>

  <div class="author-card-society">
    
      <div class="author-card-society-icon">
        <a target="_blank" rel="noopener" href="https://github.com/Uranus-s">
          <i class="iconfont social_github icon-github society-icon"></i>
        </a>
      </div>
    
  </div>

              </div>
               <div class="sticky-tablet">
  
  
    <article class="display-when-two-columns spacer">
      <div class="card card-content toc-card">
        <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringSecurity%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">SpringSecurity简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">更多使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E5%92%8C%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">登录成功和失败处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E4%B8%8D%E8%B6%B3%E5%A4%84%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">权限不足处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91"><span class="toc-number">3.3.</span> <span class="toc-text">自定义登录逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">3.4.</span> <span class="toc-text">认证授权注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Secured"><span class="toc-number">3.4.1.</span> <span class="toc-text">@Secured</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PreAuthorize"><span class="toc-number">3.4.2.</span> <span class="toc-text">@PreAuthorize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PostAuthorize"><span class="toc-number">3.4.3.</span> <span class="toc-text">@PostAuthorize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PreFilter-PostFilter"><span class="toc-number">3.4.4.</span> <span class="toc-text">@PreFilter &#x2F; @PostFilter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E4%BD%8F%E6%88%91"><span class="toc-number">3.5.</span> <span class="toc-text">记住我</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88JWT"><span class="toc-number">4.</span> <span class="toc-text">整合JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">4.1.</span> <span class="toc-text">导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJWT%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">创建JWT工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJwtUser%E7%B1%BB"><span class="toc-number">4.3.</span> <span class="toc-text">创建JwtUser类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJwtUserService"><span class="toc-number">4.4.</span> <span class="toc-text">创建JwtUserService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.5.</span> <span class="toc-text">自定义用户登录拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.6.</span> <span class="toc-text">自定义权限拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringSecurity%E9%85%8D%E7%BD%AE"><span class="toc-number">4.7.</span> <span class="toc-text">SpringSecurity配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">参考：</span></a></li></ol>
      </div>
    </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header">
    <i 
      class="iconfont icon-fenlei" 
      style="padding-right: 2px;">
    </i>分类
  </div>
  <div class="categories-list">
    
      <a href="/categories/Java/">
        <div class="categories-list-item">
          Java
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/SpringBoot/">
        <div class="categories-list-item">
          SpringBoot
          <span class="categories-list-item-badge">8</span>
        </div>
      </a>
    
      <a href="/categories/WPF/">
        <div class="categories-list-item">
          WPF
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Docker/">
        <div class="categories-list-item">
          Docker
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/Net/">
        <div class="categories-list-item">
          Net
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/DotNetCore/">
        <div class="categories-list-item">
          DotNetCore
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/%E6%8E%92%E5%BA%8F/">
        <div class="categories-list-item">
          排序
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Redis/">
        <div class="categories-list-item">
          Redis
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/COS/">
        <div class="categories-list-item">
          COS
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/Spring/">
        <div class="categories-list-item">
          Spring
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header">
    <i 
      class="iconfont icon-biaoqian" 
      style="padding-right: 2px;">
    </i>热门标签
  </div>
  <div class="tags-list">
    
      <a 
        href="/tags/Spring/" 
        title="Spring">
        <div class="tags-list-item">Spring</div>
      </a>
    
      <a 
        href="/tags/SpringBoot/" 
        title="SpringBoot">
        <div class="tags-list-item">SpringBoot</div>
      </a>
    
      <a 
        href="/tags/Redis/" 
        title="Redis">
        <div class="tags-list-item">Redis</div>
      </a>
    
      <a 
        href="/tags/DotNetCore/" 
        title="DotNetCore">
        <div class="tags-list-item">DotNetCore</div>
      </a>
    
      <a 
        href="/tags/Docker/" 
        title="Docker">
        <div class="tags-list-item">Docker</div>
      </a>
    
      <a 
        href="/tags/Java/" 
        title="Java">
        <div class="tags-list-item">Java</div>
      </a>
    
      <a 
        href="/tags/Kafka/" 
        title="Kafka">
        <div class="tags-list-item">Kafka</div>
      </a>
    
      <a 
        href="/tags/Elasticsearch/" 
        title="Elasticsearch">
        <div class="tags-list-item">Elasticsearch</div>
      </a>
    
      <a 
        href="/tags/COS/" 
        title="COS">
        <div class="tags-list-item">COS</div>
      </a>
    
      <a 
        href="/tags/Vue/" 
        title="Vue">
        <div class="tags-list-item">Vue</div>
      </a>
    
      <a 
        href="/tags/%E8%85%BE%E8%AE%AF%E4%BA%91/" 
        title="腾讯云">
        <div class="tags-list-item">腾讯云</div>
      </a>
    
      <a 
        href="/tags/HTML/" 
        title="HTML">
        <div class="tags-list-item">HTML</div>
      </a>
    
      <a 
        href="/tags/Quartz/" 
        title="Quartz">
        <div class="tags-list-item">Quartz</div>
      </a>
    
      <a 
        href="/tags/OData/" 
        title="OData">
        <div class="tags-list-item">OData</div>
      </a>
    
      <a 
        href="/tags/Shiro/" 
        title="Shiro">
        <div class="tags-list-item">Shiro</div>
      </a>
    
      <a 
        href="/tags/%E6%8E%92%E5%BA%8F/" 
        title="排序">
        <div class="tags-list-item">排序</div>
      </a>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
            <aside class="right-column">
              <div class="sticky-widescreen">
  
  
    <article class="card card-content toc-card">
      <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringSecurity%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">SpringSecurity简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">更多使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E5%92%8C%E5%A4%B1%E8%B4%A5%E5%A4%84%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">登录成功和失败处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E4%B8%8D%E8%B6%B3%E5%A4%84%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">权限不足处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91"><span class="toc-number">3.3.</span> <span class="toc-text">自定义登录逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">3.4.</span> <span class="toc-text">认证授权注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Secured"><span class="toc-number">3.4.1.</span> <span class="toc-text">@Secured</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PreAuthorize"><span class="toc-number">3.4.2.</span> <span class="toc-text">@PreAuthorize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PostAuthorize"><span class="toc-number">3.4.3.</span> <span class="toc-text">@PostAuthorize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PreFilter-PostFilter"><span class="toc-number">3.4.4.</span> <span class="toc-text">@PreFilter &#x2F; @PostFilter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E4%BD%8F%E6%88%91"><span class="toc-number">3.5.</span> <span class="toc-text">记住我</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88JWT"><span class="toc-number">4.</span> <span class="toc-text">整合JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">4.1.</span> <span class="toc-text">导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJWT%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">创建JWT工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJwtUser%E7%B1%BB"><span class="toc-number">4.3.</span> <span class="toc-text">创建JwtUser类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJwtUserService"><span class="toc-number">4.4.</span> <span class="toc-text">创建JwtUserService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.5.</span> <span class="toc-text">自定义用户登录拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">4.6.</span> <span class="toc-text">自定义权限拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringSecurity%E9%85%8D%E7%BD%AE"><span class="toc-number">4.7.</span> <span class="toc-text">SpringSecurity配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">参考：</span></a></li></ol>
    </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header">
    <i 
      class="iconfont icon-wenzhang_huaban" 
      style="padding-right: 2px;">
    </i>最近文章
  </div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-07-13</div>
        <a href="/2021/07/13/%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/"><div class="recent-posts-item-content">注解和反射</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-06-22</div>
        <a href="/2021/06/22/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><div class="recent-posts-item-content">JUC并发编程</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-06-22</div>
        <a href="/2021/06/22/%E5%85%AB%E5%A4%A7%E6%8E%92%E5%BA%8F/"><div class="recent-posts-item-content">八大排序</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2021-06-18</div>
        <a href="/2021/06/18/Java-%E9%9B%86%E5%90%88/"><div class="recent-posts-item-content">Java-集合</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
          </div>
        </div>
      </div>
    </div>
     
    <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>
          Copyright ©
          
            2020 -
          
          2021
        </span>
        &nbsp;
        <a 
          href="/" 
          class="footer-link">
          Gas
        </a>
      </div>
    </div>

    
      <div class="footer-dsc">
        
          Powered by
          <a 
            href="https://hexo.io/" 
            class="footer-link" 
            target="_blank" 
            rel="nofollow noopener noreferrer">
            &nbsp;Hexo
          </a>
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          Theme -
          <a 
            href="https://github.com/theme-kaze" 
            class="footer-link" 
            target="_blank"
            rel="nofollow noopener noreferrer">
            &nbsp;Kaze
          </a>
        
      </div>
    
    
    
    
      <div class="footer-dsc">
        
          本站总访问量<span id="busuanzi_value_site_pv"></span>次
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          本站总访客数<span id="busuanzi_value_site_uv"></span>次
        
      </div>
      
    
</footer> 
    
  <a 
    role="button" 
    id="scrollbutton" 
    class="basebutton" 
    aria-label="回到顶部">
    <i class="iconfont icon-arrowleft button-icon"></i>
  </a>

<a 
  role="button" 
  id="menubutton" 
  class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a 
  role="button" 
  id="popbutton" 
  class="basebutton" 
  aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a 
  role="button" 
  id="darkbutton" 
  class="basebutton darkwidget" 
  aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a 
  role="button" 
  id="searchbutton" 
  class="basebutton searchwidget" 
  aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a> 
     
     
     
      <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img')
    var i
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a')
      wrapper.setAttribute('href', img[i].getAttribute('data-src'))
      wrapper.setAttribute('aria-label', 'illustration')
      wrapper.style.cssText =
        'width: 100%; display: flex; justify-content: center;'
      if (img[i].alt) wrapper.dataset.caption = img[i].alt
      wrapper.dataset.nolink = true
      img[i].before(wrapper)
      wrapper.append(img[i])
      var divWrap = document.createElement('div')
      divWrap.classList.add('gallery')
      wrapper.before(divWrap)
      divWrap.append(wrapper)
    }
    baguetteBox.run('.gallery')
  }
</script>
<script>
  loadScript(
    "/js/lib/lightbox/baguetteBox.min.js",
    addImgLayout
  )
</script>
 
     
     
    <script src="/js/main.js"></script> 
    
      <script> 
        loadScript('/js/lib/busuanzi.min.js') 
      </script>
     
    
      <script>
        var addLazyload = function () {
          var observer = lozad('.lozad', {
            load: function (el) {
              el.srcset = el.getAttribute('data-src')
            },
            loaded: function (el) {
              el.classList.add('loaded')
            },
          })
          observer.observe()
        }
      </script>
      <script>
        loadScript('/js/lib/lozad.min.js', addLazyload)
      </script>
     
    
    
      <script>
        setTimeout(() => {localSearch("search.json")}, 0)
      </script>
    
  </body>
</html>
